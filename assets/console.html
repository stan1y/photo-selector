<!DOCTYPE>
<html>
	<head>
		<title>Servo</title>
		<meta charset="utf-9" />
		<meta name="description" content="Servo Console" />

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

		<script>
			$(document).ready(function() {
				var sendBtn = $("#send")[0],
					resetBtn = $("#reset")[0];

				var reset = function() {
					$("#alert-warn").hide();
					$("#alert-error").hide();
					$("div.form-group").removeClass("has-error");
				};

				var onServoError = function(xhr, type, ex) {
					console.log("Error received: " + xhr.responseText);
					$("#alert-error").children(".details").html(xhr.responseText);
					$("#alert-error").show();
				};

				var onServoSuccess = function(data) {
					$("#body").val(data);
				};

				var send = function(clientId, method, itemKey, dataType, data) {
					var servoUrl = "https://" + window.location.host
					             + "/" + itemKey;
					console.log("servoUrl=" + servoUrl);
					$.ajax(servoUrl, {
						method: method,
						dataType: dataType,
						data: data,
						error: onServoError,
						success:onServoSuccess
					});
				};

				$(sendBtn).on("click", function() {

					var clientId = $("#client-id").val(),
						itemKey = $("#item-key").val(),
						contentType = $("#content-type").val(),
						method = $("#method").val(),
						body = $("body").val(),
						error = false;

					reset();
					if (clientId.length == 0) {
						error = true;
						$("#client-id").parent().parent('.form-group').addClass("has-error");
					}

					if (itemKey.length == 0) {
						error = true;
						$("#item-key").parent().parent('.form-group').addClass("has-error");
					}

					console.log("clientId=" + clientId);
					console.log("itemKey=" + itemKey);
					console.log("contentType=" + contentType);
					console.log("method=" + method);
					console.log("bodylen=" + body.length);

					if (error) {
						$("#alert-warn").show();
						return;
					}

					return send(clientId, method, itemKey, contentType, body);
				});

				$(resetBtn).on("click", function() {
					reset();
					resetBtn.val("");
				});
			});
		</script>
	</head>

	<body>
		<div class="container">
			<form class="form-horizontal">
				<fieldset>
					<legend>Servo Debug Console</legend>
					
					<div id="alert-warn" class="alert alert-warning" style="display: none;">
					 	<strong>Warning!</strong> Please correct your input.
					 	<p class="details"></p>
					</div>
					<div id="alert-error" class="alert alert-danger" style="display: none;">
		  				<strong>Error!</strong> Request to Servo failed with an error.
		  				<p class="details"></p>
					</div>
					
					<div class="form-group">
						<label class="col-md-4 control-label" for="client-id">
							X-Servo-Client
						</label>  
						<div class="col-md-6">
							<input id="client-id" 
								name="client-id" 
								type="text"
								value="$CLIENTID$"
								placeholder="My-Example-Client" 
								class="form-control input-md">
							<span class="help-block">
								You client identifier string. Can be anything specific to you. Generated and sent by server if ommited.
							</span>  
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-4 control-label" for="item-key">
							Item Key
						</label>  
						<div class="col-md-6">
							<input id="item-key" 
								name="item-key" 
								type="text" 
								placeholder="/foo/bar" 
								class="form-control input-md">
							<span class="help-block">
								Unique identifier of an item referenced in Servo.
							</span>  
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-4 control-label">
							Operation
						</label>  
						<div class="col-md-3">
							<select id="method" 
								name="method"  
								class="form-control input-md">
								<option value="GET">GET</option>
								<option value="HEAD">HEAD</option>
								<option value="POST">POST</option>
								<option value="PUT">PUT</option>
								<option value="DELETE">DELETE</option>
							</select>
						</div>
						<div class="col-md-3">
							<select id="content-type"
								name="content-type"
								class="form-control input-md">
								<option value="text/plain">String</option>
								<option value="application/json">JSON</option>
								<option value="multipart/form-data">Binary</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-4 control-label">
							Content
						</label>  
						<div class="col-md-5">
							<textarea id="body" 
								name="body"
								rows=6
								class="form-control" readonly></textarea>
							<span class="help-block">
								Content of the item as received from or sent to a http request.
							</span>  
						</div>
						<div class="col-md-1">
							<button type="button"
								id="send"
								class="btn btn-s btn-primary"">Send</button>
							<br/>
							<br/>
							<button type="button"
								id="reset"
								class="btn btn-s btn-warning">Reset</button>
						<div>
					</div>
				</fieldset>
			</form>
		</div>
	</body>

</html>
